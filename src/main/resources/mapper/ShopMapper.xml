<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lbx.distribution.manageserver.mapper.ShopMapper">
    <resultMap id="ShopEntityVoMap" type="com.lbx.distribution.manageserver.entity.shop.ShopEntityVo">
        <id column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="merchant_id" property="merchantId" jdbcType="INTEGER"/>
        <result column="company_id" property="companyId" jdbcType="INTEGER"/>
        <result column="shop_name" property="shopName" jdbcType="VARCHAR"/>
        <result column="business_type" property="businessType" jdbcType="VARCHAR"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="city_code" property="cityCode" jdbcType="VARCHAR"/>
        <result column="area_name" property="areaName" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="lng" property="lng" jdbcType="DOUBLE"/>
        <result column="lat" property="lat" jdbcType="DOUBLE"/>
        <result column="location_type" property="locationType" jdbcType="INTEGER"/>
        <result column="contact_name" property="contactName" jdbcType="VARCHAR"/>
        <result column="contact_phone" property="contactPhone" jdbcType="CHAR"/>
        <result column="id_card" property="idCard" jdbcType="CHAR"/>
        <result column="create_time" property="createTime" jdbcType="INTEGER"/>
        <result column="update_time" property="updateTime" jdbcType="INTEGER"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>
        <result column="provinceid" property="provinceid" jdbcType="CHAR" />
        <result column="origin_shop_id" property="originShopId" jdbcType="CHAR" />
        <result column="province_name" property="provinceName" javaType="java.lang.String" jdbcType="VARCHAR" />
        <result column="areaid" property="areaid" javaType="java.lang.String" jdbcType="CHAR" />
        <result column="shop_type" property="shopType" javaType="java.lang.String" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="ShopEntityMap" type="com.lbx.distribution.manageserver.entity.shop.ShopEntity">
        <id column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="merchant_id" property="merchantId" jdbcType="INTEGER"/>
        <result column="company_id" property="companyId" jdbcType="INTEGER"/>
        <result column="shop_name" property="shopName" jdbcType="VARCHAR"/>
        <result column="business_type" property="businessType" jdbcType="VARCHAR"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="city_code" property="cityCode" jdbcType="VARCHAR"/>
        <result column="area_name" property="areaName" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="lng" property="lng" jdbcType="DOUBLE"/>
        <result column="lat" property="lat" jdbcType="DOUBLE"/>
        <result column="location_type" property="locationType" jdbcType="INTEGER"/>
        <result column="contact_name" property="contactName" jdbcType="VARCHAR"/>
        <result column="contact_phone" property="contactPhone" jdbcType="CHAR"/>
        <result column="id_card" property="idCard" jdbcType="CHAR"/>
        <result column="create_time" property="createTime" jdbcType="INTEGER"/>
        <result column="update_time" property="updateTime" jdbcType="INTEGER"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="remarks" property="remarks" jdbcType="VARCHAR"/>

        <result column="origin_shop_id" property="originShopId" jdbcType="CHAR" />
        <result column="provinceid" property="provinceid" jdbcType="CHAR" />
        <result column="province_name" property="provinceName" javaType="java.lang.String" jdbcType="VARCHAR" />
        <result column="areaid" property="areaid" javaType="java.lang.String" jdbcType="CHAR" />
        <result column="shop_type" property="shopType" javaType="java.lang.String" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="ShopExportMap" type="com.lbx.distribution.manageserver.entity.shop.ShopExport">
        <id column="shop_id" property="shopId" jdbcType="INTEGER"/>
        <result column="shop_name" property="shopName" jdbcType="VARCHAR"/>
        <result column="origin_shop_id" property="originShopId" jdbcType="CHAR" />
        <result column="create_time" property="createTime" jdbcType="INTEGER"/>
    </resultMap>
    <sql id="Base_Column_List">
    shop_id, merchant_id, company_id, shop_name, shop_type, business_type, provinceid, province_name,
    city_name, city_code, areaid, area_name, address, lng, lat, location_type, contact_name,
    contact_phone, origin_shop_id, id_card, create_time, update_time, status, remarks
  </sql>

    <!--新增门店 -->
    <insert id="insertShop" parameterType="com.lbx.distribution.manageserver.entity.shop.ShopEntityVo">
        insert into tb_shop
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="originShopId != null">
                origin_shop_id,
            </if>
            <if test="merchantId != null">
                merchant_id,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="shopName != null">
                shop_name,
            </if>
            <if test="shopType != null">
                shop_type,
            </if>
            <if test="businessType != null">
                business_type,
            </if>
            <if test="provinceid != null and provinceid != ''">
                provinceid,
            </if>
            <if test="provinceName != null">
                province_name,
            </if>
            <if test="cityCode != null">
                city_code,
            </if>
            <if test="cityName != null">
                city_name,
            </if>
            <if test="areaid != null">
                areaid,
            </if>
            <if test="areaName != null">
                area_name,
            </if>
            <if test="address != null">
                address,
            </if>
            <if test="lng != null">
                lng,
            </if>
            <if test="lat != null">
                lat,
            </if>
            <if test="locationType != null">
                location_type,
            </if>
            <if test="contactName != null">
                contact_name,
            </if>
            <if test="contactPhone != null">
                contact_phone,
            </if>
            <if test="idCard != null">
                id_card,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="remarks != null">
                remarks,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="originShopId != null">
                #{originShopId,jdbcType=CHAR},
            </if>
            <if test="merchantId != null">
                #{merchantId,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=INTEGER},
            </if>
            <if test="shopName != null">
                #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopType != null">
                #{shopType,jdbcType=VARCHAR},
            </if>
            <if test="businessType != null">
                #{businessType,jdbcType=INTEGER},
            </if>
            <if test="provinceid != null and provinceid != ''">
                #{provinceid},
            </if>
            <if test="provinceName != null">
                #{provinceName},
            </if>
            <if test="cityCode != null">
                #{cityCode},
            </if>
            <if test="cityName != null">
                #{cityName},
            </if>
            <if test="areaid != null">
                #{areaid},
            </if>
            <if test="areaName != null">
                #{areaName},
            </if>
            <if test="address != null">
                #{address,jdbcType=VARCHAR},
            </if>
            <if test="lng != null">
                #{lng,jdbcType=DECIMAL},
            </if>
            <if test="lat != null">
                #{lat,jdbcType=DECIMAL},
            </if>
            <if test="locationType != null">
                #{locationType,jdbcType=INTEGER},
            </if>
            <if test="contactName != null">
                #{contactName,jdbcType=VARCHAR},
            </if>
            <if test="contactPhone != null">
                #{contactPhone,jdbcType=CHAR},
            </if>
            <if test="idCard != null">
                #{idCard,jdbcType=CHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="updateTime != null">
                #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="remarks != null">
                #{remarks,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>

    <!--修改门店信息(待定)，根据门店ID-->
    <update id="updateShopByShopId" parameterType="com.lbx.distribution.manageserver.entity.shop.ShopEntityVo" >
        UPDATE
        tb_shop
        <set>
            <if test="originShopId != null">
                origin_shop_id = #{originShopId,jdbcType=CHAR},
            </if>
            <if test="shopName != null">
                shop_name = #{shopName,jdbcType=VARCHAR},
            </if>
            <if test="shopType != null">
                shop_type = #{shopType,jdbcType=VARCHAR},
            </if>
            <if test="businessType != null">
                business_type = #{businessType,jdbcType=INTEGER},
            </if>
            <if test="provinceid != null">
                provinceid = #{provinceid,jdbcType=CHAR},
            </if>
            <if test="cityName != null">
                city_name = #{cityName,jdbcType=VARCHAR},
            </if>
            <if test="cityCode != null">
                city_code = #{cityCode,jdbcType=CHAR},
            </if>
            <if test="areaid != null">
                areaid = #{areaid,jdbcType=CHAR},
            </if>
            <if test="areaName != null">
                area_name = #{areaName,jdbcType=VARCHAR},
            </if>
            <if test="address != null">
                address = #{address,jdbcType=VARCHAR},
            </if>
            <if test="lng != null">
                lng = #{lng,jdbcType=DECIMAL},
            </if>
            <if test="lat != null">
                lat = #{lat,jdbcType=DECIMAL},
            </if>
            <if test="locationType != null">
                location_type = #{locationType,jdbcType=INTEGER},
            </if>
            <if test="contactName != null">
                contact_name = #{contactName,jdbcType=VARCHAR},
            </if>
            <if test="contactPhone != null">
                contact_phone = #{contactPhone,jdbcType=CHAR},
            </if>
            <if test="idCard != null">
                id_card = #{idCard,jdbcType=CHAR},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="remarks != null">
                remarks = #{remarks,jdbcType=VARCHAR},
            </if>
        </set>
        WHERE
        shop_id = #{shopId}
    </update>

    <!--修改门店状态(待定)，根据门店ID-->
    <update id="updateShopStatus" >
        UPDATE
        tb_shop
        <set>
            <if test="status != null ">
                status = #{status},
            </if>
            <if test="updateTime != null ">
                update_time= #{updateTime}
            </if>
        </set>
        WHERE
        1=1
        <if test="shopId != null">
            AND shop_id = #{shopId}
        </if>
        <if test="companyId != null">
            AND company_id = #{companyId}
        </if>
        <if test="merchantId != null">
            AND merchant_id = #{merchantId}
        </if>
    </update>

    <!--关联公司，根据门店ID-->
    <update id="contactCompanyByShopId" >
        UPDATE
        tb_shop
        <set>
            <if test="companyId != null ">
                company_id = #{companyId},
            </if>
        </set>
        WHERE
        shop_id = #{shopId}
    </update>

    <!--根据商户ID删除单个商户-->
    <delete id="deleteByShopId" parameterType="java.lang.Integer">
        DELETE
        FROM
            tb_shop
        WHERE
            shop_id = #{shopId}
    </delete>

    <!-- 查询门店列表(支持多条件查询，分页查询) -->
    <select id="queryShopList" resultMap="ShopEntityVoMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
            tb_shop
        WHERE
        status != -1
        <if test="merchantId != null ">
            AND merchant_id = #{merchantId}
        </if>
        <if test="companyId != null ">
            AND company_id= #{companyId}
        </if>
        <if test="status != null ">
            AND status= #{status}
        </if>
        <if test="cityName != null and cityName != '' ">
            AND city_name= #{cityName}
        </if>
        <if test="shopName != null and shopName != '' ">
            AND shop_name LIKE "%"#{shopName}"%"
        </if>
        <if test="startTime != null">
            AND  create_time &gt;= #{startTime}
        </if>
        <if test="endTime != null ">
            AND  create_time &lt;= #{endTime}
        </if>
    </select>

    <!-- 多条件查询门店（单个） -->
    <select id="queryShop" resultMap="ShopEntityMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        tb_shop
        WHERE
        1=1
        <if test="merchantId != null ">
           AND  merchant_id = #{merchantId}
        </if>
        <if test="companyId != null ">
            AND company_id= #{companyId}
        </if>
        <if test="status != null ">
            AND status= #{status}
        </if>
        <if test="address != null ">
            AND address = #{address}
        </if>
        <if test="cityName != null and cityName != '' ">
            AND city_name= #{cityName}
        </if>
        <if test="shopName != null and shopName != '' ">
            AND shop_name = #{shopName}
        </if>
        <if test="lng != null ">
            AND lng = #{lng}
        </if>
        <if test="lat != null ">
            AND lat = #{lat}
        </if>
        <if test="createTime != null">
            AND  create_time = #{createTime}
        </if>
        <if test="startTime != null">
            AND  create_time &gt;= #{startTime}
        </if>
        <if test="endTime != null ">
            AND  create_time &lt;= #{endTime}
        </if>
    </select>

    <!--获取门店菜单(角色(0.管理员;1:普通商户))-->
    <select id="getShopMenu" resultType="com.lbx.distribution.manageserver.entity.MenuEntity">
        SELECT
        shop_id id, shop_name `name`
        FROM
        tb_shop
        WHERE
        `status` != -1
        <if test="type == 2 and id != null ">
            AND company_id = #{id}
        </if>
    </select>

    <!-- 查询所有门店(预留) -->
    <select id="queryAllShops" resultMap="ShopEntityVoMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
            tb_shop
    </select>

    <!--查询门店总数-->
    <select id="findTotalNumber" resultType="java.lang.Integer">
        SELECT
            count(*)
        FROM
            tb_shop
    </select>

    <!--查询单个门店信息，根据门店ID-->
    <select id="queryShopByShopId" resultMap="ShopEntityVoMap" parameterType="java.lang.Integer">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
            tb_shop
        WHERE
            shop_id = #{shopId}
    </select>

    <!--查询相关联的门店名称，根据门店ID-->
    <select id="queryShopsByShopId" parameterType="java.lang.Integer">
        SELECT
            shop_name shopName
        FROM
            tb_shop
        WHERE
            company_id = #{companyId}
    </select>

    <!--查询相关联的门店信息，根据商户ID-->
    <select id="queryShopsByMerchantId" resultMap="ShopEntityVoMap" parameterType="java.lang.Integer">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
            tb_shop
        WHERE
            merchant_id = #{merchantId}
    </select>

    <!--查询相关联的门店信息，根据公司ID-->
    <select id="queryShopsByCompanyId" resultMap="ShopEntityVoMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
            tb_shop
        WHERE
            company_id = #{companyId}
    </select>

    <!--查询门店编号是否已存在，根据门店编码-->
    <select id="isExist" resultType="java.lang.Integer">
        SELECT
            count(*)
        FROM
            tb_shop
        WHERE
            shop_id = #{shopId}
    </select>

    <!-- 查询所有门店(导入使用) -->
    <select id="queryAllShopsToImport" resultType="com.lbx.distribution.manageserver.entity.shop.ShopImport">
        SELECT
            shop_id shopId,
            shop_name shopName,
            lng,
            lat
        FROM
            tb_shop
    </select>

    <!--导入新增门店 -->
    <insert id="insertShopImport" parameterType="com.lbx.distribution.manageserver.entity.shop.ShopImport" useGeneratedKeys="true" keyProperty="shopId">
    insert into tb_shop
    <trim prefix="(" suffix=")" suffixOverrides=",">
        <if test="originShopId != null">
            origin_shop_id,
        </if>
        <if test="merchantId != null">
            merchant_id,
        </if>
        <if test="companyId != null">
            company_id,
        </if>
        <if test="shopName != null">
            shop_name,
        </if>
        <if test="shopAddress != null">
            address,
        </if>
        <if test="shopType != null">
            shop_type,
        </if>
        <if test="provinceId != null and provinceId != ''">
            provinceid,
        </if>
        <if test="provinceName != null">
            province_name,
        </if>
        <if test="cityId != null">
            city_code,
        </if>
        <if test="cityName != null">
            city_name,
        </if>
        <if test="areaId != null">
            areaid,
        </if>
        <if test="areaName != null">
            area_name,
        </if>
        <if test="lng != null">
            lng,
        </if>
        <if test="lat != null">
            lat,
        </if>
        <if test="businessType != null">
            business_type,
        </if>
        <if test="contactPhone != null">
            contact_phone,
        </if>
        <if test="contactName != null">
            contact_name,
        </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
        <if test="originShopId != null">
            #{originShopId,jdbcType=CHAR},
        </if>
        <if test="merchantId != null">
            #{merchantId},
        </if>
        <if test="companyId != null">
            #{companyId},
        </if>
        <if test="shopName != null">
            #{shopName},
        </if>
        <if test="shopAddress != null">
            #{shopAddress},
        </if>
        <if test="shopType != null">
            #{shopType},
        </if>
        <if test="provinceId != null and provinceId != ''">
            #{provinceId},
        </if>
        <if test="provinceName != null">
            #{provinceName},
        </if>
        <if test="cityId != null">
            #{cityId},
        </if>
        <if test="cityName != null">
            #{cityName},
        </if>
        <if test="areaId != null">
            #{areaId},
        </if>
        <if test="areaName != null">
            #{areaName},
        </if>
        <if test="lng != null">
            #{lng},
        </if>
        <if test="lat != null">
            #{lat},
        </if>
        <if test="businessType != null">
            #{businessType},
        </if>
        <if test="contactPhone != null">
            #{contactPhone},
        </if>
        <if test="contactName != null">
            #{contactName},
        </if>
    </trim>
    </insert>

    <!-- 导出门店列表 -->
    <select id="queryShopExcelList" resultMap="ShopExportMap">
        SELECT
        shop_id,shop_name,origin_shop_id,create_time
        FROM
        tb_shop
        WHERE
        status != -1
        <if test="merchantId != null ">
            AND merchant_id = #{merchantId}
        </if>
        <if test="companyId != null ">
            AND company_id= #{companyId}
        </if>

    </select>
</mapper>