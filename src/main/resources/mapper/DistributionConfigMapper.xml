<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lbx.distribution.manageserver.mapper.DistributionConfigMapper">
    <resultMap id="BaseResultMap" type="com.lbx.distribution.manageserver.entity.channel.DistributionConfig">
      <id column="conf_id" property="confId" jdbcType="INTEGER" />
        <result column="priority_time" property="priorityTime" jdbcType="INTEGER" />
        <result column="merchant_id" property="merchantId" jdbcType="INTEGER" />
      <result column="shop_id" property="shopId" jdbcType="INTEGER" />
      <result column="company_id" property="companyId" jdbcType="INTEGER" />
      <result column="distribute_rule" property="distributeRule" jdbcType="INTEGER" />
      <result column="distribute_channelid" property="distributeChannelid" jdbcType="INTEGER" />
      <result column="time_start" property="timeStart" jdbcType="BIGINT" />
      <result column="time_end" property="timeEnd" jdbcType="BIGINT" />
      <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
      <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
      <result column="status" property="status" jdbcType="INTEGER" />
  </resultMap>
    <resultMap id="VoResultMap" type="com.lbx.distribution.manageserver.entity.channel.DistributionConfigVo">
        <id column="conf_id" property="confId" jdbcType="INTEGER" />
        <result column="priority_time" property="priorityTime" jdbcType="INTEGER" />
        <result column="merchant_id" property="merchantId" jdbcType="INTEGER" />
        <result column="shop_id" property="shopId" jdbcType="INTEGER" />
        <result column="company_id" property="companyId" jdbcType="INTEGER" />
        <result column="distribute_rule" property="distributeRule" jdbcType="INTEGER" />
        <result column="distribute_channelid" property="distributeChannelid" jdbcType="INTEGER" />
        <result column="time_start" property="timeStart" jdbcType="BIGINT" />
        <result column="time_end" property="timeEnd" jdbcType="BIGINT" />
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
        <result column="status" property="status" jdbcType="INTEGER" />
    </resultMap>
    <sql id="Base_Column_List">
    conf_id,priority_time, merchant_id, shop_id, company_id, distribute_rule, distribute_channelid,
    time_start, time_end, create_time, update_time, status
</sql>

    <!--查询分发设置列表-->
    <select id="queryDistrConfigList" resultMap="VoResultMap">
        select
        <include refid="Base_Column_List" />
        from tb_distribution_config
        where
        `status` != -1
        <if test="confId != null">
            AND conf_id != #{confId}
        </if>
        <if test="merchantId != null">
            AND merchant_id = #{merchantId}
        </if>
        <if test="merchantIds != null">
            AND merchant_id IN
            <foreach item="merchantId" index="index" collection="merchantIds"
                     open="(" separator="," close=")"> #{merchantId}</foreach>
        </if>
        <if test="companyId != null">
            AND company_id = #{companyId}
        </if>
        <if test="shopId != null">
            AND shop_id = #{shopId}
        </if>
        ORDER BY create_time DESC
    </select>

    <!--根据公司id查询分发设置列表-->
    <select id="queryDistrConfigsByCompanyIds" resultMap="VoResultMap">
        select
        <include refid="Base_Column_List" />
        from tb_distribution_config
        where
        `status` != -1
        <if test="companyIds != null">
            company_id IN
            <foreach item="companyId" index="index" collection="companyIds"
                     open="(" separator="," close=")"> #{companyId}</foreach>
        </if>
    </select>

    <!--新增分发设置-->
    <insert id="addDistributeConfig" parameterType="com.lbx.distribution.manageserver.entity.channel.DistributionConfigVo">
        insert into tb_distribution_config
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="merchantId != null">
                merchant_id,
            </if>
            <if test="shopId != null">
                shop_id,
            </if>
            <if test="companyId != null">
                company_id,
            </if>
            <if test="distributeRule != null">
                distribute_rule,
            </if>
            <if test="distributeChannelid != null">
                distribute_channelid,
            </if>
            <if test="priorityTime != null">
                priority_time,
            </if>
            <if test="timeStart != null">
                time_start,
            </if>
            <if test="timeEnd != null">
                time_end,
            </if>
            <if test="status != null">
                status
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="merchantId != null">
                #{merchantId,jdbcType=INTEGER},
            </if>
            <if test="shopId != null">
                #{shopId,jdbcType=INTEGER},
            </if>
            <if test="companyId != null">
                #{companyId,jdbcType=INTEGER},
            </if>
            <if test="distributeRule != null">
                #{distributeRule,jdbcType=INTEGER},
            </if>
            <if test="distributeChannelid != null">
                #{distributeChannelid,jdbcType=INTEGER},
            </if>
            <if test="priorityTime != null">
                #{priorityTime,jdbcType=INTEGER},
            </if>
            <if test="timeStart != null">
                #{timeStart,jdbcType=BIGINT},
            </if>
            <if test="timeEnd != null">
                #{timeEnd,jdbcType=BIGINT},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER}
            </if>
        </trim>
    </insert>

    <!--更新分发规则-->
    <update id="updateDistrConfig" parameterType="com.lbx.distribution.manageserver.entity.channel.DistributionConfigVo">
        update tb_distribution_config
        <set>
            <if test="priorityTime != null">
                priority_time = #{priorityTime,jdbcType=INTEGER},
            </if>
            <if test="timeStart != null">
                time_start = #{timeStart,jdbcType=BIGINT},
            </if>
            <if test="timeEnd != null">
                time_end = #{timeEnd,jdbcType=BIGINT},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
        </set>
        where conf_id = #{confId,jdbcType=INTEGER}
    </update>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from tb_distribution_config
    where conf_id = #{confId,jdbcType=INTEGER}
  </delete>
</mapper>